<!doctype html><html lang=fa dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>گیت چطور فایل‌ها رو ذخیره می‌کنه؟ | SYN Packet</title><meta name=keywords content="git"><meta name=description content="جواب خیلی کوتاه
گیت فایل‌ها رو بر اساس محتواشون ذخیره میکنه.
جواب کوتاه نسبتاً بلند
اول کار که شما دستور git init رو اجرا می‌کنید، گیت داخل پوشه‌ی جاری یه فولدر .git می‌سازه که محتویاتش اینه:
[meysampg@freedom git]$ git init
Initialized empty Git repository in /srv/http/test/git/.git/
[meysampg@freedom git]$ ls -lah .git
total 40K
drwxr-xr-x 7 meysampg users 4.0K Mar 10 11:07 .
drwxr-xr-x 3 meysampg users 4.0K Mar 10 11:07 ..
drwxr-xr-x 2 meysampg users 4.0K Mar 10 11:07 branches
-rw-r--r-- 1 meysampg users   92 Mar 10 11:07 config
-rw-r--r-- 1 meysampg users   73 Mar 10 11:07 description
-rw-r--r-- 1 meysampg users   23 Mar 10 11:07 HEAD
drwxr-xr-x 2 meysampg users 4.0K Mar 10 11:07 hooks
drwxr-xr-x 2 meysampg users 4.0K Mar 10 11:07 info
drwxr-xr-x 4 meysampg users 4.0K Mar 10 11:07 objects
drwxr-xr-x 4 meysampg users 4.0K Mar 10 11:07 refs
چیزی که جواب سوال بالاست در پوشه‌ی objects نهفته‌ست."><meta name=author content="میثم پورگنجی"><link rel=canonical href=https://pourganji.ir/fa/blog/how-git-store-files/><link crossorigin=anonymous href=/assets/css/stylesheet.a28591458c0b9b8fa6621794ae94ef19bbdefde5e8b4335f7b66f7e0317d81d5.css integrity="sha256-ooWRRYwLm4+mYheUrpTvGbve/eXotDNfe2b34DF9gdU=" rel="preload stylesheet" as=style><link rel=icon href=https://pourganji.ir/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://pourganji.ir/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://pourganji.ir/favicon-32x32.png><link rel=apple-touch-icon href=https://pourganji.ir/apple-touch-icon.png><link rel=mask-icon href=https://pourganji.ir/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=fa href=https://pourganji.ir/fa/blog/how-git-store-files/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://pourganji.ir/fa/blog/how-git-store-files/"><meta property="og:site_name" content="SYN Packet"><meta property="og:title" content="گیت چطور فایل‌ها رو ذخیره می‌کنه؟"><meta property="og:description" content="جواب خیلی کوتاه گیت فایل‌ها رو بر اساس محتواشون ذخیره میکنه.
جواب کوتاه نسبتاً بلند اول کار که شما دستور git init رو اجرا می‌کنید، گیت داخل پوشه‌ی جاری یه فولدر .git می‌سازه که محتویاتش اینه:
[meysampg@freedom git]$ git init Initialized empty Git repository in /srv/http/test/git/.git/ [meysampg@freedom git]$ ls -lah .git total 40K drwxr-xr-x 7 meysampg users 4.0K Mar 10 11:07 . drwxr-xr-x 3 meysampg users 4.0K Mar 10 11:07 .. drwxr-xr-x 2 meysampg users 4.0K Mar 10 11:07 branches -rw-r--r-- 1 meysampg users 92 Mar 10 11:07 config -rw-r--r-- 1 meysampg users 73 Mar 10 11:07 description -rw-r--r-- 1 meysampg users 23 Mar 10 11:07 HEAD drwxr-xr-x 2 meysampg users 4.0K Mar 10 11:07 hooks drwxr-xr-x 2 meysampg users 4.0K Mar 10 11:07 info drwxr-xr-x 4 meysampg users 4.0K Mar 10 11:07 objects drwxr-xr-x 4 meysampg users 4.0K Mar 10 11:07 refs چیزی که جواب سوال بالاست در پوشه‌ی objects نهفته‌ست."><meta property="og:locale" content="fa-IR"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2018-03-10T19:03:34+03:30"><meta property="article:modified_time" content="2018-03-10T19:03:34+03:30"><meta property="article:tag" content="Git"><meta name=twitter:card content="summary"><meta name=twitter:title content="گیت چطور فایل‌ها رو ذخیره می‌کنه؟"><meta name=twitter:description content="جواب خیلی کوتاه
گیت فایل‌ها رو بر اساس محتواشون ذخیره میکنه.
جواب کوتاه نسبتاً بلند
اول کار که شما دستور git init رو اجرا می‌کنید، گیت داخل پوشه‌ی جاری یه فولدر .git می‌سازه که محتویاتش اینه:
[meysampg@freedom git]$ git init
Initialized empty Git repository in /srv/http/test/git/.git/
[meysampg@freedom git]$ ls -lah .git
total 40K
drwxr-xr-x 7 meysampg users 4.0K Mar 10 11:07 .
drwxr-xr-x 3 meysampg users 4.0K Mar 10 11:07 ..
drwxr-xr-x 2 meysampg users 4.0K Mar 10 11:07 branches
-rw-r--r-- 1 meysampg users   92 Mar 10 11:07 config
-rw-r--r-- 1 meysampg users   73 Mar 10 11:07 description
-rw-r--r-- 1 meysampg users   23 Mar 10 11:07 HEAD
drwxr-xr-x 2 meysampg users 4.0K Mar 10 11:07 hooks
drwxr-xr-x 2 meysampg users 4.0K Mar 10 11:07 info
drwxr-xr-x 4 meysampg users 4.0K Mar 10 11:07 objects
drwxr-xr-x 4 meysampg users 4.0K Mar 10 11:07 refs
چیزی که جواب سوال بالاست در پوشه‌ی objects نهفته‌ست."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://pourganji.ir/fa/blog/"},{"@type":"ListItem","position":2,"name":"گیت چطور فایل‌ها رو ذخیره می‌کنه؟","item":"https://pourganji.ir/fa/blog/how-git-store-files/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"گیت چطور فایل‌ها رو ذخیره می‌کنه؟","name":"گیت چطور فایل‌ها رو ذخیره می‌کنه؟","description":"جواب خیلی کوتاه گیت فایل‌ها رو بر اساس محتواشون ذخیره میکنه.\nجواب کوتاه نسبتاً بلند اول کار که شما دستور git init رو اجرا می‌کنید، گیت داخل پوشه‌ی جاری یه فولدر .git می‌سازه که محتویاتش اینه:\n[meysampg@freedom git]$ git init Initialized empty Git repository in /srv/http/test/git/.git/ [meysampg@freedom git]$ ls -lah .git total 40K drwxr-xr-x 7 meysampg users 4.0K Mar 10 11:07 . drwxr-xr-x 3 meysampg users 4.0K Mar 10 11:07 .. drwxr-xr-x 2 meysampg users 4.0K Mar 10 11:07 branches -rw-r--r-- 1 meysampg users 92 Mar 10 11:07 config -rw-r--r-- 1 meysampg users 73 Mar 10 11:07 description -rw-r--r-- 1 meysampg users 23 Mar 10 11:07 HEAD drwxr-xr-x 2 meysampg users 4.0K Mar 10 11:07 hooks drwxr-xr-x 2 meysampg users 4.0K Mar 10 11:07 info drwxr-xr-x 4 meysampg users 4.0K Mar 10 11:07 objects drwxr-xr-x 4 meysampg users 4.0K Mar 10 11:07 refs چیزی که جواب سوال بالاست در پوشه‌ی objects نهفته‌ست.\n","keywords":["git"],"articleBody":"جواب خیلی کوتاه گیت فایل‌ها رو بر اساس محتواشون ذخیره میکنه.\nجواب کوتاه نسبتاً بلند اول کار که شما دستور git init رو اجرا می‌کنید، گیت داخل پوشه‌ی جاری یه فولدر .git می‌سازه که محتویاتش اینه:\n[meysampg@freedom git]$ git init Initialized empty Git repository in /srv/http/test/git/.git/ [meysampg@freedom git]$ ls -lah .git total 40K drwxr-xr-x 7 meysampg users 4.0K Mar 10 11:07 . drwxr-xr-x 3 meysampg users 4.0K Mar 10 11:07 .. drwxr-xr-x 2 meysampg users 4.0K Mar 10 11:07 branches -rw-r--r-- 1 meysampg users 92 Mar 10 11:07 config -rw-r--r-- 1 meysampg users 73 Mar 10 11:07 description -rw-r--r-- 1 meysampg users 23 Mar 10 11:07 HEAD drwxr-xr-x 2 meysampg users 4.0K Mar 10 11:07 hooks drwxr-xr-x 2 meysampg users 4.0K Mar 10 11:07 info drwxr-xr-x 4 meysampg users 4.0K Mar 10 11:07 objects drwxr-xr-x 4 meysampg users 4.0K Mar 10 11:07 refs چیزی که جواب سوال بالاست در پوشه‌ی objects نهفته‌ست.\nگیت یک سیستم محتوا-آدرسی‌ه، بدین معنی که گیت بدون توجه به نام فایل و بر اساس محتوا یک کلید منحصربفرد برای هر فایل می‌سازه (که همون هش SHA1ی هست که موقع کامیت کردن نشون میده) و اون رو داخل پوشه‌ی objects بر اساس قاعده‌ی زیر ذخیره می‌کنه:\nتو یه رشته بنویس blob و بعدش فاصله و بعدش طول محتوای فایل و بعدش کاراکتر نال رو بذار (مثلا blob 4\\0). به رشته‌ی بالا محتوای فایل رو بچسبون (مثلا blob 4\\0pgpg). از رشته‌ی مرحله‌ی ۲ یه هش SHA1 بگیر و از این به بعد این میشه شناسه‌ی این فایل (مثلا برای رشته‌ی بالا میشه c8f50ec947636ea1e848da84bc6e844f593426a1). دو کاراکتر اول رشته‌ی حاصل از مرحله‌ی ۳ رو بردار و داخل پوشه‌ی objects یه پوشه بساز. با ۳۸ کاراکتر باقی‌مانده یه فایل داخل پوشه‌ای که ساختی بساز (مثلا میشه objects/c8/f50ec947636ea1e848da84bc6e844f593426a1). با ZLib محتوای مرحله‌ی ۲ رو فشرده کن و اونو داخل فایلی که در مرحله‌ی ۴ ساختی ذخیره کن. یعنی اگر بخوایم با پایتون این پنج مرحله رو کد بزنیم به اینطور چیزی می‌رسیم:\nimport hashlib import os import zlib def get_file_content(path) -\u003e str: with open(path) as f: return f.read() # step 1 \u0026 2 def generate_blob_text(content: str) -\u003e str: return 'blob {}\\0{}'.format(len(content), content) # step 3 def generate_hash(content: str) -\u003e str: return hashlib.sha1(content.encode('utf-8')).hexdigest() # step 5 :) def generate_zlib_content(content: str) -\u003e bytes: return zlib.compress(content.encode('utf-8')) # step 4 def create_file(hash: str, content: str) -\u003e int: folder = hash[:2] filename = hash[2:] path = os.path.join('./', folder, filename) os.makedirs(folder, exist_ok=True) with open(path, 'w') as f: return f.write(content) # all together def store_like_git(path: str): content = get_file_content(path) blob = generate_blob_text(content) blob_hash = generate_hash(blob) compressed_blob = generate_zlib_content(blob).hex() return create_file(blob_hash, compressed_blob) store_like_git('./file.txt') پس اسم فایل‌ها چی میشن؟ همه چی آبجکته تا اینجا گفتیم گیت فایل‌ها رو بر اساس محتوا ذخیره می‌کنه، نه اسم فایل. و خب سوال پیش میاد که چطور میشه رد تغییرات یک فایل مشخص رو گرفت؟ پرمیژن فایل‌ها چی میشن؟ کی کجا رفت و این داستانا. اینجاست که باید یه کم برگردیم عقب‌تر: «اصن اون blob چی بود؟». جواب این سوال مشخص می‌کنه که تروالدز چه مغز خفنی داره. داخل گیت خبری از تایپ‌های مختلف برای ذخیره‌سازی اطلاعات مختلف نیست. «تو گیت همه چی آبجکته». آبجکت یعنی همون چیزی که تو مرحله‌ی قبل ساخته شد. همه چی به همون صورت ساخته میشه ولی برای اینکه هش یه فایل و یه آبجکت از نوع دیگه (که در ادامه می‌بینیم چیا هستن) از شانس ما یکی در نیاد، با گذاشتن blob اول کار انگار یه فضای نام برای هر کدوم از تایپ‌ها اختصاص می‌دیم. در کل گیت چهار نوع آبجکت اصلی داره:\nblob tree commit tag درخت و اینجا بر می‌گردیم به سوال اصلی. تو قسمت قبل متوجه شدیم که محتوای هر فایل به صورت blob ذخیره میشه. برای تکمیل پازل، گیت از آبجکت tree استفاده می‌کنه تا هر چیز مرتبط با ساختار مخزن (repository) رو ذخیره کنه. ساختارش هم خیلی ساده‌ست. یه آبکجت tree شامل یک یا چند خطه که:\nدر خط اول کلمه‌ی tree میاد و بعد یه فاصله و بعد اندازه‌ی خط بعد و در انتها یه کاراکتر نال \\0. بعد از خط اول، در هر خط، اول پرمیژن و اجازه‌ی اجرا مشخص میشه: 100644: فایل معمولی 100755: فایل اجرایی 120000: لینک نمادین (sym link) 040000: پوشه (در واقع یه tree دیگه) بعد یه فاصله میاد و اسم اون آبجکت بعد یه کاراکتر نال میاد و بعدش هش به سبک قسمت اول که به آبجکتی که دخیره شده اشاره می‌کنه یعنی اگه بخوایم خودمونی‌تر به ماجرا اشاره کنیم، برای ذخیره‌ی a/b/c/d.txt تا الان با دوتا آبجکت blob و tree که تعریف کردیم، گیت این مسیر رو میره: a (tree) └─ b (tree) └─ c (tree) └─ d (blob) یعنی فولدر گیت ما (با آبجکت‌هایی که تا حالا شناختیم) میشه ۳تا درخت و یه blob.\nتا اینجا تونستیم یه شکلی از ذخیره‌سازی فایل‌ها رو داشته باشیم و به جواب سوال «گیت چطور فایل‌ها رو ذخیره می‌کنه؟» رسیدیم. گیت فایل رو نه بر اساس اسم و کپی کردن، که بر اساس محتوا هش می‌کنه و فایل‌ها رو هم داخل یه درخت قرار می‌ده. و خب یچی کمه هنوز.\nگیت چطور تاریخچه نگه می‌داره؟ اگه صرفا دنبال نگه داشتن فایل بودیم واقعاً این همه دنگ و فنگ نیاز نبود. خود سیستم‌عامل تقریباً همه‌ی این چیزایی که صحبت شد رو داره و داشت کارش رو می‌کرد. کل ماجرا از اونجا شروع میشه که کی چیکار کرد و کِی؟ در جواب این مسئله گیت میاد آبجکت commit رو معرفی می‌کنه. کامیت همون آبجکتیه که به صورت روزمره باهاش سر و کله می‌زنیم با دستور git log عموماً می‌بینیمش:\nmeysam@Meysams-Mac git % git log commit 46fc19645c43b01d3291f76304a8058112193138 Author: Meysam P. Ganji Date: Wed Feb 11 02:19:20 2026 +0330 first commit وقتی کامیت می‌کنیم برای اینکه ببینیم، آبجکت کامیت چیه، اول می‌ریم سر وقت زیردستور کامیت. فرض کنیم فایل‌های زیر تغییر پیدا کردن:\n└─ a └─ b └─ c.txt └─ d └─ e.txt └─ f └─ g.txt h.txt وقتی ما کامند git add رو می‌زنیم، گیت blob هر کدوم از فایل‌هایی که تغییر کردن رو می‌سازه و بعد از اون وقتیgit commit می‌کنیم، از برگ‌ها شروع می‌کنه و شروع به ساختن آبجکت‌های tree می‌کنه. یعنی در مرحله‌ی اول ۳تا آبجکت درخت ساخته میشه:\nT(b) -\u003e c.txt T(d) -\u003e e.txt T(f) -\u003e g.txt در مرحله‌ی بعد، یه لول از برگ‌هایی که بهشون اشاره کرده بالاتر میاد و یه آبجکت درخت برای a می‌سازه:\nT(a) -\u003e T(b), T(d) و در نهایت آبجکت نهایی رو می‌سازه که اسمش رو می‌ذاریم T:\nT -\u003e T(a), T(f), h.txt الان ما با داشتن T، می‌تونیم هر زمان به حالتی که این درخت ساخته برگردیم و این همون چیزیه که آبجکت کامیت نگه می‌داره.\nآبجکت کامیت بالطبع، مثل بقیه‌ی آبجکت‌ها، اول فایل commit میاد و طول خطوط بعدی و کاراکتر نال و بعدش:\nکلمه‌ی tree و هش درختی داره بهش اشاره می‌کنه (در مثال بالا میشه T) و در آخر کاراکتر \\n کلمه‌ی parent و هش کامیت قبلی (کامیتـ(هایـ)ـی که موقع ساختن این کامیت فعال بوده/ن) و کاراکتر \\n کلمه‌ی author و اسم و ایمیل و زمان ایجاد کامیت توسط سازنده اصلی \\n کلمه‌ی committer و اسم و ایمیل و زمان کامیت کردن \\n اطلاعات مربوط با ساین اگه باشه مسیج کامیت \\n نشانه‌گذاری حالت‌های خاص در نهایت حالت‌هایی در تاریخچه‌ی گیت هست که نیازه در خود تاریخچه با یه اسم و رسم درست مشخص شن و برای این منظور آبجکت tag معرفی میشه.\nتفاوت تگ و برنچ چیه؟ به نظر می‌رسه که برنچ و تگ یکی باشن. هر دو دارن اسم می‌ذارن روی یک حالت خاص. ولی اینطور نیست. برنچ‌ها فقط رفرنس‌هایی هستن به یه کامیت مشخص و هر زمان می‌تونن تغییر کنن. این تیکه کد می‌تونه ماجرا رو واضح‌تر کنه:\nmeysam@Meysams-Mac git % gch -b \"fdf\" Switched to a new branch 'fdf' meysam@Meysams-Mac git % gch - Switched to branch 'main' meysam@Meysams-Mac refs % cd .git/refs/heads meysam@Meysams-Mac heads % ll total 16 -rw-r--r--@ 1 meysam staff 41B Feb 11 14:09 fdf -rw-r--r--@ 1 meysam staff 41B Feb 11 02:19 main meysam@Meysams-Mac heads % cat fdf 46fc19645c43b01d3291f76304a8058112193138 meysam@Meysams-Mac heads % cat main 46fc19645c43b01d3291f76304a8058112193138 یه برنچ فقط یه فایل ساده‌ست که داخلش هش یه کامیته. هر لحظه می‌تونه پاک شه یا به کامیت دیگه‌ای اشاره کنه. ولی تگ، یک آبجکته که داخل هیستوری گیت می‌شینه و نمیشه تغییرش داد (میشه ولی باید تاریخچه‌ی گیت رو بازنویسی کرد). پس برای موارد موقتی برنچ‌ها سریع و کار راه اندازن، ولی برای مواردی که نیازه که یک حالت مشخص در تاریخ گیت ثبت شه و اسم و رسم کسی که ثبت کرده هم باقی بمونه (مثل ریلیزها) از تگ استفاده میشه.\nنمونه‌ی جمع و جور این اسنیپت نشون میده که چطور میشه محتویات یه مخزن گیت رو دید و تریس کرد و رفت جلو. دستور cat-file محتویات رو نشون میده با دوتا سوئیچ کاربردی:\nسوئیچ t: تایپ آبجکت سوئیچ p: چاپ خوشگل meysam@Meysams-Mac git % git init Initialized empty Git repository in /Users/meysam/test/git/.git/ meysam@Meysams-Mac git % ga file.txt meysam@Meysams-Mac git % gc \"first commit\" [main (root-commit) 08ec49b] first commit 1 file changed, 1 insertion(+) create mode 100644 file.txt meysam@Meysams-Mac git % git cat-file -t 08ec49b commit meysam@Meysams-Mac git % git cat-file -p 08ec49b tree 70bd082dc4cdea292e136794fcab576352451191 author Meysam P. Ganji 1770759888 +0330 committer Meysam P. Ganji 1770759888 +0330 gpgsig -----BEGIN PGP SIGNATURE----- iQIzBAABCAAdFiEE9KVakJAdWESNuaZ6/uk7It4xDeQFAmmLptAACgkQ/uk7It4x DeQjyA//dSA+N+WEr+qdftbjCj6yOxpcv070FIJNz1TGr8pPBo9oXaMOxmeF8GtD PBJ7LC/AGLiQIsiTMABC2vqX6Mu0nvjZ7xNabXzJsWhg7IiXc5492Crtg6KYr9ld GMqrFHwhim/FVvS/MhFEDMRObSstCs1ThBFcn/vMcw43HyQsy9YEhwMRQB/d0WTI qFbeHVF65gUlMPnVHPGJg4uWwT0cG3Z/oEQUed0xvQ54TV9aX3UFGTOYkvkAHYDz ut85s/hnDbmlfw0bP10nWiSJKISQw7xQdudsZwqOC4+/uxdmMQQ2m0naftZCWN9b 2LA+girvaykXuFSJwtVSHW5jHjrRPhoG6cjovr/N0pQOyhip7RbrNXgQEo5Ok5fH 2td+v3nP8v31JaqGwN02JQukNmXyP3GyDr/WQVf3VvU8i71KRUUJVae1Nw+8owJM qvZUSRznKHZoP5/bMoJ5rgIzHBueyZiJfN3XbfAQrysKFsg3qjND8CMGkDdpS7ed 0umD5ngzfBF7fl06se9NiWIUUZxqKIONawadffXMwuB43dSLCurSZ8gGY+YHWn3p Il8SdQxnnjqxWf28xJZL0c5fWSoV/0KLGxNzlutPxswNyaz20tAnrixg39ZNxyZL uhLxTuPljKJkuGC1FFZIaraIMnU9sam+yEKTGKI4+WoAaDWcGws= =nQAD -----END PGP SIGNATURE----- first commit meysam@Meysams-Mac git % git cat-file -p 70bd08 100644 blob 6fe0c98f9b56645abb217983d4f2180a4fdce66b\tfile.txt meysam@Meysams-Mac git % git cat-file -t 6fe0c blob meysam@Meysams-Mac git % git cat-file -p 6fe0c pgpg و برای دیدن محتویات خام، این بش فانکشن کمک می‌کنه:\nfunction view_object() { python3 -c 'import sys,zlib;print(zlib.decompress(sys.stdin.buffer.read()))' \u003c .git/objects/\"${1:0:2}\"/\"${1:2}\" | cat -v } خب که چه فایده؟ آبجکت دیدن هر چیزی بر اساس محتوای فایل داخل گیت، چندتا فایده‌ی اساسی داره.\nدو فایل با محتوای یکسان = یک blob برای گیت فرقی نمی‌کنه اگه فایل‌های یکسان، اسم یا مسیرشون فرق کنه. چون محتواشون یکیه blobشون هم یکیه. این دست‌آورد حجم مخزن رو کنترل‌شده نگه می‌داره (جدا از اینکه خود مخزن بعداً فشرده هم میشه و گاربج کالکتور داره) و برای داشتن تاریخچه‌های مختلف نیاز نیست کل کد رو با هر بار تغییر کپی کرد. برای تست کردن میشه از کد اول کار استفاده کرد یا راحت‌تر از زیردستور hash-object بهره برد:\nmeysam@Meysams-Mac git % printf \"pgpg\" \u003e a.txt meysam@Meysams-Mac git % printf \"pgpg\" \u003e b.txt meysam@Meysams-Mac git % git hash-object a.txt 6fe0c98f9b56645abb217983d4f2180a4fdce66b meysam@Meysams-Mac git % git hash-object b.txt 6fe0c98f9b56645abb217983d4f2180a4fdce66b تغییر اسم تقریباً رایگانه گفتیم که ساختار با tree مشخص می‌شه و blobها هم فقط بر اساس محتوای فایل ساخته میشن. این یعنی با تغییر اسم یه فایل یا دایرکتوری، فقط یه آبجکت جدید درخت ساخته می‌شه که به ساختار جدید اشاره می‌کنه. طبعاً نتیجه‌ی مستقیم این مورد، داشتن چیزی مثل اسنپ‌شات و سفر در زمانه.\nجهان‌های موازی با داشتن امکان پریدن بین درخت‌های مختلف (که ساختارهای مختلف رو نشون میدن)، ابزارهایی مثل git blame و git bisect ساخته میشن. شما برای اینکه هر حالت ممکنی از تاریخچه رو ببینی، کافیه هش آبجکت کامیت رو داشته باشی و یک یا چند درخت رو پیمایش کنی تا به وضعیت کد در اون حالت برسی.\nپایان در نهایت باید گیت رو به عنوان یک دیتابیس فایل بر اساس محتوا دید. ما هر بار در حال ساختن blobها و احتمالاً treeهای مربوط به فایلا هستیم و این یعنی رفتن از یک اسنپ‌شات به یه اسنپ‌شات دیگه (مثل time travel در delta fromatها). همین.\n","wordCount":"1855","inLanguage":"fa","datePublished":"2018-03-10T19:03:34+03:30","dateModified":"2018-03-10T19:03:34+03:30","author":{"@type":"Person","name":"میثم پورگنجی"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://pourganji.ir/fa/blog/how-git-store-files/"},"publisher":{"@type":"Organization","name":"SYN Packet","logo":{"@type":"ImageObject","url":"https://pourganji.ir/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://pourganji.ir/fa/ accesskey=h title="SYN Packet (Alt + H)">SYN Packet</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://pourganji.ir/fa/blog/ title=بلاگ><span>بلاگ</span></a></li><li><a href=https://pourganji.ir/fa/about/ title=درباره><span>درباره</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://pourganji.ir/fa/>خانه</a>&nbsp;»&nbsp;<a href=https://pourganji.ir/fa/blog/>بلاگ</a></div><h1 class="post-title entry-hint-parent">گیت چطور فایل‌ها رو ذخیره می‌کنه؟</h1><div class=post-meta><span title='2018-03-10 19:03:34 +0330 +0330'>10 مارس 2018</span>&nbsp;·&nbsp;<span>میثم پورگنجی</span>&nbsp;|&nbsp;<span>
<a href=https://github.com/meysampg/meysampg.github.io/edit/master/content/blog/how-git-store-files/index.md rel="noopener noreferrer edit" target=_blank>پیشنهاد تغییر</a></span></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>فهرست مطالب</span></summary><div class=inner><ul><li><a href=#%d8%ac%d9%88%d8%a7%d8%a8-%d8%ae%db%8c%d9%84%db%8c-%da%a9%d9%88%d8%aa%d8%a7%d9%87 aria-label="جواب خیلی کوتاه">جواب خیلی کوتاه</a></li><li><a href=#%d8%ac%d9%88%d8%a7%d8%a8-%da%a9%d9%88%d8%aa%d8%a7%d9%87-%d9%86%d8%b3%d8%a8%d8%aa%d8%a7-%d8%a8%d9%84%d9%86%d8%af aria-label="جواب کوتاه نسبتاً بلند">جواب کوتاه نسبتاً بلند</a></li><li><a href=#%d9%be%d8%b3-%d8%a7%d8%b3%d9%85-%d9%81%d8%a7%db%8c%d9%84%d9%87%d8%a7-%da%86%db%8c-%d9%85%db%8c%d8%b4%d9%86 aria-label="پس اسم فایل‌ها چی میشن؟">پس اسم فایل‌ها چی میشن؟</a><ul><li><a href=#%d9%87%d9%85%d9%87-%da%86%db%8c-%d8%a2%d8%a8%d8%ac%da%a9%d8%aa%d9%87 aria-label="همه چی آبجکته">همه چی آبجکته</a></li><li><a href=#%d8%af%d8%b1%d8%ae%d8%aa aria-label=درخت>درخت</a></li></ul></li><li><a href=#%da%af%db%8c%d8%aa-%da%86%d8%b7%d9%88%d8%b1-%d8%aa%d8%a7%d8%b1%db%8c%d8%ae%da%86%d9%87-%d9%86%da%af%d9%87-%d9%85%db%8c%d8%af%d8%a7%d8%b1%d9%87 aria-label="گیت چطور تاریخچه نگه می‌داره؟">گیت چطور تاریخچه نگه می‌داره؟</a><ul><li><a href=#%d9%88%d9%82%d8%aa%db%8c-%da%a9%d8%a7%d9%85%db%8c%d8%aa-%d9%85%db%8c%da%a9%d9%86%db%8c%d9%85 aria-label="وقتی کامیت می‌کنیم">وقتی کامیت می‌کنیم</a></li><li><a href=#%d8%a2%d8%a8%d8%ac%da%a9%d8%aa-%da%a9%d8%a7%d9%85%db%8c%d8%aa aria-label="آبجکت کامیت">آبجکت کامیت</a></li></ul></li><li><a href=#%d9%86%d8%b4%d8%a7%d9%86%d9%87%da%af%d8%b0%d8%a7%d8%b1%db%8c-%d8%ad%d8%a7%d9%84%d8%aa%d9%87%d8%a7%db%8c-%d8%ae%d8%a7%d8%b5 aria-label="نشانه‌گذاری حالت‌های خاص">نشانه‌گذاری حالت‌های خاص</a><ul><li><a href=#%d8%aa%d9%81%d8%a7%d9%88%d8%aa-%d8%aa%da%af-%d9%88-%d8%a8%d8%b1%d9%86%da%86-%da%86%db%8c%d9%87 aria-label="تفاوت تگ و برنچ چیه؟">تفاوت تگ و برنچ چیه؟</a></li></ul></li><li><a href=#%d9%86%d9%85%d9%88%d9%86%d9%87%db%8c-%d8%ac%d9%85%d8%b9-%d9%88-%d8%ac%d9%88%d8%b1 aria-label="نمونه‌ی جمع و جور">نمونه‌ی جمع و جور</a></li><li><a href=#%d8%ae%d8%a8-%da%a9%d9%87-%da%86%d9%87-%d9%81%d8%a7%db%8c%d8%af%d9%87 aria-label="خب که چه فایده؟">خب که چه فایده؟</a><ul><li><a href=#%d8%af%d9%88-%d9%81%d8%a7%db%8c%d9%84-%d8%a8%d8%a7-%d9%85%d8%ad%d8%aa%d9%88%d8%a7%db%8c-%db%8c%da%a9%d8%b3%d8%a7%d9%86--%db%8c%da%a9-blob aria-label="دو فایل با محتوای یکسان = یک blob">دو فایل با محتوای یکسان = یک blob</a></li><li><a href=#%d8%aa%d8%ba%db%8c%db%8c%d8%b1-%d8%a7%d8%b3%d9%85-%d8%aa%d9%82%d8%b1%db%8c%d8%a8%d8%a7-%d8%b1%d8%a7%db%8c%da%af%d8%a7%d9%86%d9%87 aria-label="تغییر اسم تقریباً رایگانه">تغییر اسم تقریباً رایگانه</a></li><li><a href=#%d8%ac%d9%87%d8%a7%d9%86%d9%87%d8%a7%db%8c-%d9%85%d9%88%d8%a7%d8%b2%db%8c aria-label="جهان‌های موازی">جهان‌های موازی</a></li></ul></li><li><a href=#%d9%be%d8%a7%db%8c%d8%a7%d9%86 aria-label=پایان>پایان</a></li></ul></div></details></div><div class=post-content><h2 id=جواب-خیلی-کوتاه>جواب خیلی کوتاه<a hidden class=anchor aria-hidden=true href=#جواب-خیلی-کوتاه>#</a></h2><p>گیت فایل‌ها رو بر اساس محتواشون ذخیره میکنه.</p><h2 id=جواب-کوتاه-نسبتا-بلند>جواب کوتاه نسبتاً بلند<a hidden class=anchor aria-hidden=true href=#جواب-کوتاه-نسبتا-بلند>#</a></h2><p>اول کار که شما دستور <code>git init</code> رو اجرا می‌کنید، گیت داخل پوشه‌ی جاری یه فولدر <code>.git</code> می‌سازه که محتویاتش اینه:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>meysampg@freedom git<span style=color:#f92672>]</span>$ git init
</span></span><span style=display:flex><span>Initialized empty Git repository in /srv/http/test/git/.git/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>meysampg@freedom git<span style=color:#f92672>]</span>$ ls -lah .git
</span></span><span style=display:flex><span>total 40K
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>7</span> meysampg users 4.0K Mar <span style=color:#ae81ff>10</span> 11:07 .
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>3</span> meysampg users 4.0K Mar <span style=color:#ae81ff>10</span> 11:07 ..
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>2</span> meysampg users 4.0K Mar <span style=color:#ae81ff>10</span> 11:07 branches
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> meysampg users   <span style=color:#ae81ff>92</span> Mar <span style=color:#ae81ff>10</span> 11:07 config
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> meysampg users   <span style=color:#ae81ff>73</span> Mar <span style=color:#ae81ff>10</span> 11:07 description
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> meysampg users   <span style=color:#ae81ff>23</span> Mar <span style=color:#ae81ff>10</span> 11:07 HEAD
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>2</span> meysampg users 4.0K Mar <span style=color:#ae81ff>10</span> 11:07 hooks
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>2</span> meysampg users 4.0K Mar <span style=color:#ae81ff>10</span> 11:07 info
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>4</span> meysampg users 4.0K Mar <span style=color:#ae81ff>10</span> 11:07 objects
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>4</span> meysampg users 4.0K Mar <span style=color:#ae81ff>10</span> 11:07 refs
</span></span></code></pre></div><p>چیزی که جواب سوال بالاست در پوشه‌ی <code>objects</code> نهفته‌ست.</p><p>گیت یک سیستم محتوا-آدرسی‌ه، بدین معنی که گیت بدون توجه به نام فایل و بر اساس محتوا یک کلید منحصربفرد برای هر فایل می‌سازه (که همون هش SHA1ی هست که موقع کامیت کردن نشون میده) و اون رو داخل پوشه‌ی <code>objects</code> بر اساس قاعده‌ی زیر ذخیره می‌کنه:</p><ol><li>تو یه رشته بنویس blob و بعدش فاصله و بعدش طول محتوای فایل و بعدش کاراکتر نال رو بذار (مثلا <code>blob 4\0</code>).</li><li>به رشته‌ی بالا محتوای فایل رو بچسبون (مثلا <code>blob 4\0pgpg</code>).</li><li>از رشته‌ی مرحله‌ی ۲ یه هش SHA1 بگیر و از این به بعد این میشه شناسه‌ی این فایل (مثلا برای رشته‌ی بالا میشه <code>c8f50ec947636ea1e848da84bc6e844f593426a1</code>).</li><li>دو کاراکتر اول رشته‌ی حاصل از مرحله‌ی ۳ رو بردار و داخل پوشه‌ی <code>objects</code> یه پوشه بساز. با ۳۸ کاراکتر باقی‌مانده یه فایل داخل پوشه‌ای که ساختی بساز (مثلا میشه <code>objects/c8/f50ec947636ea1e848da84bc6e844f593426a1</code>).</li><li>با <code>ZLib</code> محتوای مرحله‌ی ۲ رو فشرده کن و اونو داخل فایلی که در مرحله‌ی ۴ ساختی ذخیره کن.</li></ol><p>یعنی اگر بخوایم با پایتون این پنج مرحله رو کد بزنیم به اینطور چیزی می‌رسیم:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> hashlib
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> zlib
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_file_content</span>(path) <span style=color:#f92672>-&gt;</span> str:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(path) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> f<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># step 1 &amp; 2</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_blob_text</span>(content: str) <span style=color:#f92672>-&gt;</span> str:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;blob </span><span style=color:#e6db74>{}</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(len(content), content)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># step 3</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_hash</span>(content: str) <span style=color:#f92672>-&gt;</span> str:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> hashlib<span style=color:#f92672>.</span>sha1(content<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#39;utf-8&#39;</span>))<span style=color:#f92672>.</span>hexdigest()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># step 5 :)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_zlib_content</span>(content: str) <span style=color:#f92672>-&gt;</span> bytes:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> zlib<span style=color:#f92672>.</span>compress(content<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#39;utf-8&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># step 4</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_file</span>(hash: str, content: str) <span style=color:#f92672>-&gt;</span> int:
</span></span><span style=display:flex><span>    folder <span style=color:#f92672>=</span> hash[:<span style=color:#ae81ff>2</span>]
</span></span><span style=display:flex><span>    filename <span style=color:#f92672>=</span> hash[<span style=color:#ae81ff>2</span>:]
</span></span><span style=display:flex><span>    path <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(<span style=color:#e6db74>&#39;./&#39;</span>, folder, filename)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    os<span style=color:#f92672>.</span>makedirs(folder, exist_ok<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(path, <span style=color:#e6db74>&#39;w&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> f<span style=color:#f92672>.</span>write(content)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># all together</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>store_like_git</span>(path: str):
</span></span><span style=display:flex><span>    content <span style=color:#f92672>=</span> get_file_content(path)
</span></span><span style=display:flex><span>    blob <span style=color:#f92672>=</span> generate_blob_text(content)
</span></span><span style=display:flex><span>    blob_hash <span style=color:#f92672>=</span> generate_hash(blob)
</span></span><span style=display:flex><span>    compressed_blob <span style=color:#f92672>=</span> generate_zlib_content(blob)<span style=color:#f92672>.</span>hex()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> create_file(blob_hash, compressed_blob)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>store_like_git(<span style=color:#e6db74>&#39;./file.txt&#39;</span>)
</span></span></code></pre></div><h2 id=پس-اسم-فایلها-چی-میشن>پس اسم فایل‌ها چی میشن؟<a hidden class=anchor aria-hidden=true href=#پس-اسم-فایلها-چی-میشن>#</a></h2><h3 id=همه-چی-آبجکته>همه چی آبجکته<a hidden class=anchor aria-hidden=true href=#همه-چی-آبجکته>#</a></h3><p>تا اینجا گفتیم گیت فایل‌ها رو بر اساس محتوا ذخیره می‌کنه، نه اسم فایل. و خب سوال پیش میاد که چطور میشه رد تغییرات یک فایل مشخص رو گرفت؟ پرمیژن فایل‌ها چی میشن؟ کی کجا رفت و این داستانا.
اینجاست که باید یه کم برگردیم عقب‌تر: «اصن اون <code>blob</code> چی بود؟». جواب این سوال مشخص می‌کنه که تروالدز چه مغز خفنی داره. داخل گیت خبری از تایپ‌های مختلف برای ذخیره‌سازی اطلاعات مختلف نیست. «تو گیت همه چی آبجکته».
آبجکت یعنی همون چیزی که تو مرحله‌ی قبل ساخته شد. همه چی به همون صورت ساخته میشه ولی برای اینکه هش یه فایل و یه آبجکت از نوع دیگه (که در ادامه می‌بینیم چیا هستن) از شانس ما یکی در نیاد، با گذاشتن <code>blob</code> اول کار انگار یه فضای نام برای هر کدوم از تایپ‌ها اختصاص می‌دیم.
در کل گیت چهار نوع آبجکت اصلی داره:</p><ul><li>blob</li><li>tree</li><li>commit</li><li>tag</li></ul><h3 id=درخت>درخت<a hidden class=anchor aria-hidden=true href=#درخت>#</a></h3><p>و اینجا بر می‌گردیم به سوال اصلی. تو قسمت قبل متوجه شدیم که محتوای هر فایل به صورت <code>blob</code> ذخیره میشه. برای تکمیل پازل، گیت از آبجکت <code>tree</code> استفاده می‌کنه تا هر چیز مرتبط با ساختار مخزن (repository) رو ذخیره کنه. ساختارش هم خیلی ساده‌ست. یه آبکجت <code>tree</code> شامل یک یا چند خطه که:</p><ul><li>در خط اول کلمه‌ی <code>tree</code> میاد و بعد یه فاصله و بعد اندازه‌ی خط بعد و در انتها یه کاراکتر نال <code>\0</code>.</li><li>بعد از خط اول، در هر خط، اول پرمیژن و اجازه‌ی اجرا مشخص میشه:<ul><li><code>100644</code>: فایل معمولی</li><li><code>100755</code>: فایل اجرایی</li><li><code>120000</code>: لینک نمادین (sym link)</li><li><code>040000</code>: پوشه (در واقع یه <code>tree</code> دیگه)</li></ul></li><li>بعد یه فاصله میاد و اسم اون آبجکت</li><li>بعد یه کاراکتر نال میاد و بعدش هش به سبک قسمت اول که به آبجکتی که دخیره شده اشاره می‌کنه
یعنی اگه بخوایم خودمونی‌تر به ماجرا اشاره کنیم، برای ذخیره‌ی <code>a/b/c/d.txt</code> تا الان با دوتا آبجکت <code>blob</code> و <code>tree</code> که تعریف کردیم، گیت این مسیر رو میره:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>a <span style=color:#f92672>(</span>tree<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>└─ b <span style=color:#f92672>(</span>tree<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   └─ c <span style=color:#f92672>(</span>tree<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      └─ d <span style=color:#f92672>(</span>blob<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>یعنی فولدر گیت ما (با آبجکت‌هایی که تا حالا شناختیم) میشه ۳تا درخت و یه blob.</p><p>تا اینجا تونستیم یه شکلی از ذخیره‌سازی فایل‌ها رو داشته باشیم و به جواب سوال «گیت چطور فایل‌ها رو ذخیره می‌کنه؟» رسیدیم. گیت فایل رو نه بر اساس اسم و کپی کردن، که بر اساس محتوا هش می‌کنه و فایل‌ها رو هم داخل یه درخت قرار می‌ده. و خب یچی کمه هنوز.</p><h2 id=گیت-چطور-تاریخچه-نگه-میداره>گیت چطور تاریخچه نگه می‌داره؟<a hidden class=anchor aria-hidden=true href=#گیت-چطور-تاریخچه-نگه-میداره>#</a></h2><p>اگه صرفا دنبال نگه داشتن فایل بودیم واقعاً این همه دنگ و فنگ نیاز نبود. خود سیستم‌عامل تقریباً همه‌ی این چیزایی که صحبت شد رو داره و داشت کارش رو می‌کرد. کل ماجرا از اونجا شروع میشه که کی چیکار کرد و کِی؟ در جواب این مسئله گیت میاد آبجکت <code>commit</code> رو معرفی می‌کنه. کامیت همون آبجکتیه که به صورت روزمره باهاش سر و کله می‌زنیم با دستور <code>git log</code> عموماً می‌بینیمش:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>meysam@Meysams-Mac git % git log
</span></span><span style=display:flex><span>commit 46fc19645c43b01d3291f76304a8058112193138
</span></span><span style=display:flex><span>Author: Meysam P. Ganji &lt;p.g.meysam@gmail.com&gt;
</span></span><span style=display:flex><span>Date:   Wed Feb <span style=color:#ae81ff>11</span> 02:19:20 <span style=color:#ae81ff>2026</span> +0330
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    first commit
</span></span></code></pre></div><h3 id=وقتی-کامیت-میکنیم>وقتی کامیت می‌کنیم<a hidden class=anchor aria-hidden=true href=#وقتی-کامیت-میکنیم>#</a></h3><p>برای اینکه ببینیم، آبجکت کامیت چیه، اول می‌ریم سر وقت زیردستور کامیت. فرض کنیم فایل‌های زیر تغییر پیدا کردن:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>└─ a
</span></span><span style=display:flex><span>   └─ b
</span></span><span style=display:flex><span>      └─ c.txt
</span></span><span style=display:flex><span>   └─ d
</span></span><span style=display:flex><span>      └─ e.txt
</span></span><span style=display:flex><span>└─ f
</span></span><span style=display:flex><span>   └─ g.txt
</span></span><span style=display:flex><span>h.txt 
</span></span></code></pre></div><p>وقتی ما کامند <code>git add</code> رو می‌زنیم، گیت <code>blob</code> هر کدوم از فایل‌هایی که تغییر کردن رو می‌سازه و بعد از اون وقتی<code>git commit</code> می‌کنیم، از برگ‌ها شروع می‌کنه و شروع به ساختن آبجکت‌های <code>tree</code> می‌کنه. یعنی در مرحله‌ی اول ۳تا آبجکت درخت ساخته میشه:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>T<span style=color:#f92672>(</span>b<span style=color:#f92672>)</span> -&gt; c.txt
</span></span><span style=display:flex><span>T<span style=color:#f92672>(</span>d<span style=color:#f92672>)</span> -&gt; e.txt
</span></span><span style=display:flex><span>T<span style=color:#f92672>(</span>f<span style=color:#f92672>)</span> -&gt; g.txt
</span></span></code></pre></div><p>در مرحله‌ی بعد، یه لول از برگ‌هایی که بهشون اشاره کرده بالاتر میاد و یه آبجکت درخت برای <code>a</code> می‌سازه:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>T<span style=color:#f92672>(</span>a<span style=color:#f92672>)</span> -&gt; T<span style=color:#f92672>(</span>b<span style=color:#f92672>)</span>, T<span style=color:#f92672>(</span>d<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>و در نهایت آبجکت نهایی رو می‌سازه که اسمش رو می‌ذاریم T:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>T -&gt; T<span style=color:#f92672>(</span>a<span style=color:#f92672>)</span>, T<span style=color:#f92672>(</span>f<span style=color:#f92672>)</span>, h.txt
</span></span></code></pre></div><p>الان ما با داشتن T، می‌تونیم هر زمان به حالتی که این درخت ساخته برگردیم و این همون چیزیه که آبجکت کامیت نگه می‌داره.</p><h3 id=آبجکت-کامیت>آبجکت کامیت<a hidden class=anchor aria-hidden=true href=#آبجکت-کامیت>#</a></h3><p>بالطبع، مثل بقیه‌ی آبجکت‌ها، اول فایل <code>commit</code> میاد و طول خطوط بعدی و کاراکتر نال و بعدش:</p><ul><li>کلمه‌ی <code>tree</code> و هش درختی داره بهش اشاره می‌کنه (در مثال بالا میشه <code>T</code>) و در آخر کاراکتر <code>\n</code></li><li>کلمه‌ی <code>parent</code> و هش کامیت قبلی (کامیتـ(هایـ)ـی که موقع ساختن این کامیت فعال بوده/ن) و کاراکتر <code>\n</code></li><li>کلمه‌ی <code>author</code> و اسم و ایمیل و زمان ایجاد کامیت توسط سازنده اصلی <code>\n</code></li><li>کلمه‌ی <code>committer</code> و اسم و ایمیل و زمان کامیت کردن <code>\n</code></li><li>اطلاعات مربوط با ساین اگه باشه</li><li>مسیج کامیت <code>\n</code></li></ul><h2 id=نشانهگذاری-حالتهای-خاص>نشانه‌گذاری حالت‌های خاص<a hidden class=anchor aria-hidden=true href=#نشانهگذاری-حالتهای-خاص>#</a></h2><p>در نهایت حالت‌هایی در تاریخچه‌ی گیت هست که نیازه در خود تاریخچه با یه اسم و رسم درست مشخص شن و برای این منظور آبجکت <code>tag</code> معرفی میشه.</p><h3 id=تفاوت-تگ-و-برنچ-چیه>تفاوت تگ و برنچ چیه؟<a hidden class=anchor aria-hidden=true href=#تفاوت-تگ-و-برنچ-چیه>#</a></h3><p>به نظر می‌رسه که برنچ و تگ یکی باشن. هر دو دارن اسم می‌ذارن روی یک حالت خاص. ولی اینطور نیست. برنچ‌ها فقط رفرنس‌هایی هستن به یه کامیت مشخص و هر زمان می‌تونن تغییر کنن. این تیکه کد می‌تونه ماجرا رو واضح‌تر کنه:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>meysam@Meysams-Mac git % gch -b <span style=color:#e6db74>&#34;fdf&#34;</span>
</span></span><span style=display:flex><span>Switched to a new branch <span style=color:#e6db74>&#39;fdf&#39;</span>
</span></span><span style=display:flex><span>meysam@Meysams-Mac git % gch -
</span></span><span style=display:flex><span>Switched to branch <span style=color:#e6db74>&#39;main&#39;</span>
</span></span><span style=display:flex><span>meysam@Meysams-Mac refs % cd .git/refs/heads
</span></span><span style=display:flex><span>meysam@Meysams-Mac heads % ll
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>-rw-r--r--@ <span style=color:#ae81ff>1</span> meysam  staff    41B Feb <span style=color:#ae81ff>11</span> 14:09 fdf
</span></span><span style=display:flex><span>-rw-r--r--@ <span style=color:#ae81ff>1</span> meysam  staff    41B Feb <span style=color:#ae81ff>11</span> 02:19 main
</span></span><span style=display:flex><span>meysam@Meysams-Mac heads % cat fdf
</span></span><span style=display:flex><span>46fc19645c43b01d3291f76304a8058112193138
</span></span><span style=display:flex><span>meysam@Meysams-Mac heads % cat main
</span></span><span style=display:flex><span>46fc19645c43b01d3291f76304a8058112193138
</span></span></code></pre></div><p>یه برنچ فقط یه فایل ساده‌ست که داخلش هش یه کامیته. هر لحظه می‌تونه پاک شه یا به کامیت دیگه‌ای اشاره کنه. ولی تگ، یک آبجکته که داخل هیستوری گیت می‌شینه و نمیشه تغییرش داد (میشه ولی باید تاریخچه‌ی گیت رو بازنویسی کرد). پس برای موارد موقتی برنچ‌ها سریع و کار راه اندازن، ولی برای مواردی که نیازه که یک حالت مشخص در تاریخ گیت ثبت شه و اسم و رسم کسی که ثبت کرده هم باقی بمونه (مثل ریلیزها) از تگ استفاده میشه.</p><h2 id=نمونهی-جمع-و-جور>نمونه‌ی جمع و جور<a hidden class=anchor aria-hidden=true href=#نمونهی-جمع-و-جور>#</a></h2><p>این اسنیپت نشون میده که چطور میشه محتویات یه مخزن گیت رو دید و تریس کرد و رفت جلو. دستور <code>cat-file</code> محتویات رو نشون میده با دوتا سوئیچ کاربردی:</p><ul><li>سوئیچ <code>t</code>: تایپ آبجکت</li><li>سوئیچ <code>p</code>: چاپ خوشگل</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>meysam@Meysams-Mac git % git init
</span></span><span style=display:flex><span>Initialized empty Git repository in /Users/meysam/test/git/.git/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>meysam@Meysams-Mac git % ga file.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>meysam@Meysams-Mac git % gc <span style=color:#e6db74>&#34;first commit&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>main <span style=color:#f92672>(</span>root-commit<span style=color:#f92672>)</span> 08ec49b<span style=color:#f92672>]</span> first commit
</span></span><span style=display:flex><span> <span style=color:#ae81ff>1</span> file changed, <span style=color:#ae81ff>1</span> insertion<span style=color:#f92672>(</span>+<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> create mode <span style=color:#ae81ff>100644</span> file.txt
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>meysam@Meysams-Mac git % git cat-file -t 08ec49b
</span></span><span style=display:flex><span>commit
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>meysam@Meysams-Mac git % git cat-file -p 08ec49b
</span></span><span style=display:flex><span>tree 70bd082dc4cdea292e136794fcab576352451191
</span></span><span style=display:flex><span>author Meysam P. Ganji &lt;p.g.meysam@gmail.com&gt; <span style=color:#ae81ff>1770759888</span> +0330
</span></span><span style=display:flex><span>committer Meysam P. Ganji &lt;p.g.meysam@gmail.com&gt; <span style=color:#ae81ff>1770759888</span> +0330
</span></span><span style=display:flex><span>gpgsig -----BEGIN PGP SIGNATURE-----
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> iQIzBAABCAAdFiEE9KVakJAdWESNuaZ6/uk7It4xDeQFAmmLptAACgkQ/uk7It4x
</span></span><span style=display:flex><span> DeQjyA//dSA+N+WEr+qdftbjCj6yOxpcv070FIJNz1TGr8pPBo9oXaMOxmeF8GtD
</span></span><span style=display:flex><span> PBJ7LC/AGLiQIsiTMABC2vqX6Mu0nvjZ7xNabXzJsWhg7IiXc5492Crtg6KYr9ld
</span></span><span style=display:flex><span> GMqrFHwhim/FVvS/MhFEDMRObSstCs1ThBFcn/vMcw43HyQsy9YEhwMRQB/d0WTI
</span></span><span style=display:flex><span> qFbeHVF65gUlMPnVHPGJg4uWwT0cG3Z/oEQUed0xvQ54TV9aX3UFGTOYkvkAHYDz
</span></span><span style=display:flex><span> ut85s/hnDbmlfw0bP10nWiSJKISQw7xQdudsZwqOC4+/uxdmMQQ2m0naftZCWN9b
</span></span><span style=display:flex><span> 2LA+girvaykXuFSJwtVSHW5jHjrRPhoG6cjovr/N0pQOyhip7RbrNXgQEo5Ok5fH
</span></span><span style=display:flex><span> 2td+v3nP8v31JaqGwN02JQukNmXyP3GyDr/WQVf3VvU8i71KRUUJVae1Nw+8owJM
</span></span><span style=display:flex><span> qvZUSRznKHZoP5/bMoJ5rgIzHBueyZiJfN3XbfAQrysKFsg3qjND8CMGkDdpS7ed
</span></span><span style=display:flex><span> 0umD5ngzfBF7fl06se9NiWIUUZxqKIONawadffXMwuB43dSLCurSZ8gGY+YHWn3p
</span></span><span style=display:flex><span> Il8SdQxnnjqxWf28xJZL0c5fWSoV/0KLGxNzlutPxswNyaz20tAnrixg39ZNxyZL
</span></span><span style=display:flex><span> uhLxTuPljKJkuGC1FFZIaraIMnU9sam+yEKTGKI4+WoAaDWcGws<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>=</span>nQAD
</span></span><span style=display:flex><span> -----END PGP SIGNATURE-----
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>first commit
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>meysam@Meysams-Mac git % git cat-file -p 70bd08
</span></span><span style=display:flex><span><span style=color:#ae81ff>100644</span> blob 6fe0c98f9b56645abb217983d4f2180a4fdce66b	file.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>meysam@Meysams-Mac git % git cat-file -t 6fe0c
</span></span><span style=display:flex><span>blob
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>meysam@Meysams-Mac git % git cat-file -p 6fe0c
</span></span><span style=display:flex><span>pgpg
</span></span></code></pre></div><p>و برای دیدن محتویات خام، این بش فانکشن کمک می‌کنه:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#66d9ef>function</span> view_object<span style=color:#f92672>()</span> <span style=color:#f92672>{</span> 
</span></span><span style=display:flex><span>	python3 -c <span style=color:#e6db74>&#39;import sys,zlib;print(zlib.decompress(sys.stdin.buffer.read()))&#39;</span> &lt; .git/objects/<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>1:0:2<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>/<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>1:2<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> | cat -v 
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=خب-که-چه-فایده>خب که چه فایده؟<a hidden class=anchor aria-hidden=true href=#خب-که-چه-فایده>#</a></h2><p>آبجکت دیدن هر چیزی بر اساس محتوای فایل داخل گیت، چندتا فایده‌ی اساسی داره.</p><h3 id=دو-فایل-با-محتوای-یکسان--یک-blob>دو فایل با محتوای یکسان = یک blob<a hidden class=anchor aria-hidden=true href=#دو-فایل-با-محتوای-یکسان--یک-blob>#</a></h3><p>برای گیت فرقی نمی‌کنه اگه فایل‌های یکسان، اسم یا مسیرشون فرق کنه. چون محتواشون یکیه blobشون هم یکیه. این دست‌آورد حجم مخزن رو کنترل‌شده نگه می‌داره (جدا از اینکه خود مخزن بعداً فشرده هم میشه و گاربج کالکتور داره) و برای داشتن تاریخچه‌های مختلف نیاز نیست کل کد رو با هر بار تغییر کپی کرد. برای تست کردن میشه از کد اول کار استفاده کرد یا راحت‌تر از زیردستور <code>hash-object</code> بهره برد:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>meysam@Meysams-Mac git % printf <span style=color:#e6db74>&#34;pgpg&#34;</span> &gt; a.txt
</span></span><span style=display:flex><span>meysam@Meysams-Mac git % printf <span style=color:#e6db74>&#34;pgpg&#34;</span> &gt; b.txt
</span></span><span style=display:flex><span>meysam@Meysams-Mac git % git hash-object a.txt
</span></span><span style=display:flex><span>6fe0c98f9b56645abb217983d4f2180a4fdce66b
</span></span><span style=display:flex><span>meysam@Meysams-Mac git % git hash-object b.txt
</span></span><span style=display:flex><span>6fe0c98f9b56645abb217983d4f2180a4fdce66b
</span></span></code></pre></div><h3 id=تغییر-اسم-تقریبا-رایگانه>تغییر اسم تقریباً رایگانه<a hidden class=anchor aria-hidden=true href=#تغییر-اسم-تقریبا-رایگانه>#</a></h3><p>گفتیم که ساختار با <code>tree</code> مشخص می‌شه و <code>blob</code>ها هم فقط بر اساس محتوای فایل ساخته میشن. این یعنی با تغییر اسم یه فایل یا دایرکتوری، فقط یه آبجکت جدید درخت ساخته می‌شه که به ساختار جدید اشاره می‌کنه. طبعاً نتیجه‌ی مستقیم این مورد، داشتن چیزی مثل اسنپ‌شات و سفر در زمانه.</p><h3 id=جهانهای-موازی>جهان‌های موازی<a hidden class=anchor aria-hidden=true href=#جهانهای-موازی>#</a></h3><p>با داشتن امکان پریدن بین درخت‌های مختلف (که ساختارهای مختلف رو نشون میدن)، ابزارهایی مثل <code>git blame</code> و <code>git bisect</code> ساخته میشن. شما برای اینکه هر حالت ممکنی از تاریخچه رو ببینی، کافیه هش آبجکت کامیت رو داشته باشی و یک یا چند درخت رو پیمایش کنی تا به وضعیت کد در اون حالت برسی.</p><h2 id=پایان>پایان<a hidden class=anchor aria-hidden=true href=#پایان>#</a></h2><p>در نهایت باید گیت رو به عنوان یک دیتابیس فایل بر اساس محتوا دید. ما هر بار در حال ساختن <code>blob</code>ها و احتمالاً <code>tree</code>های مربوط به فایلا هستیم و این یعنی رفتن از یک اسنپ‌شات به یه اسنپ‌شات دیگه (مثل time travel در delta fromatها). همین.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://pourganji.ir/fa/tags/git/>Git</a></li></ul><nav class=paginav><a class=next href=https://pourganji.ir/fa/blog/addressable-operand-in-golang/><span class=title>صفحه بعدی »</span><br><span>آدرس‌پذیری در گو</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://pourganji.ir/fa/>SYN Packet</a></span> ·
<span>قدرت‌گرفته از
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="کپی";function s(){t.innerHTML="کپی شد!",setTimeout(()=>{t.innerHTML="کپی"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>